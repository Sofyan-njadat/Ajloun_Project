@model List<AssociationJoinRequest>

<h2>طلبات الانضمام للهيئات الثقافية</h2>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>رقم الطلب</th>
            <th>اسم المستخدم</th>
            <th>اسم الهيئة الثقافية</th>
            <th>الحالة</th>
            <th>الإجراءات</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var request in Model)
        {
                <tr>
                    <td>@request.RequestId</td>
                    <td>@request.User.FullName</td>
                    <td>@request.Association.Name</td>
                    <td>@request.Status</td>
                    <td>
                    @if (request.Status == "Pending")
                    {
                                <form method="post" asp-action="ApproveRequest">
                                    <input type="hidden" name="requestId" value="@request.RequestId" />
                                    <button type="submit" class="btn btn-success btn-sm">موافقة</button>
                                </form>

                                <form method="post" asp-action="RejectRequest">
                                    <input type="hidden" name="requestId" value="@request.RequestId" />
                                    <button type="submit" class="btn btn-danger btn-sm">رفض</button>
                                </form>
                    }

                        <form method="post" asp-action="DeleteRequest">
                            <input type="hidden" name="requestId" value="@request.RequestId" />
                            <button type="submit" class="btn btn-warning btn-sm">حذف</button>
                        </form>
                    </td>
                </tr>
        }
    </tbody>
</table>

@section Scripts {
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script>
            function confirmDelete(requestId) {
                Swal.fire({
                    title: 'هل أنت متأكد؟',
                    text: "لن تتمكن من التراجع عن هذا الإجراء!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'نعم، احذف!',
                    cancelButtonText: 'إلغاء'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Submit the delete form
                        const form = document.createElement('form');
                        form.method = 'post';
                        form.action = '/Admin/DeleteRequest';

                        const input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = 'requestId';
                        input.value = requestId;

                        form.appendChild(input);
                        document.body.appendChild(form);
                        form.submit();
                    }
                });
            }
        </script>
}
